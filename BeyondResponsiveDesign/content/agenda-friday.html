<article>
    <nav class="toolbar hscroll">
        <ul>
            <!-- ko foreach: { data: Tracks, as: 'track' } -->
            <li data-bind="attr: { id: 'tab-' + track.Identifier }">
                <div class="highlight">&nbsp;</div>
                <a data-bind="attr: { href: 'javascript:interactions.slideToTab(\'' + track.Identifier + '\')' }">
                    <span data-bind="text: track.Id"></span>
                </a>
            </li>
            <!-- /ko -->
        </ul>
    </nav>
    <div class="slideTabContainer">
        <!-- ko foreach: { data: Tracks, as: 'track' } -->
        <section data-bind="attr: {id : track.Identifier}" class="slideTab scrollcontainer vscroll offRight">
            <header>
                <h2>
                    <i class="fa fa-lg fa-calendar"></i>
                    <span data-bind="text: track.Id"></span>
                </h2>
            </header>
            <table class="agenda">
                <tbody data-bind="foreach: { data: $root.TimeSlots, as: 'timeSlot' }">
                <!-- ko with: $root.sessionInfo(track.Identifier, timeSlot.Id) -->
                <tr data-bind="attr: { class: isSession(timeSlot, $data) }, click: $root.click">
                    <td><span data-bind="text: prettifyTime(timeSlot.Id)"></span></td>
                    <td>
                        <div>
                            <span data-bind="text: timeSlot.Info"></span>
                            <span><a data-bind="text: Title"></a></span>
                        </div>
                        <div>
                            <span data-bind="text: Speaker"></span>
                        </div>
                    </td>
                </tr>
                <!-- /ko -->
                </tbody>
            </table>
        </section>
        <!-- /ko -->
    </div>
</article>
<aside class="propertySheet wide offRight"></aside>
<script type="text/javascript">
    var agendaLoaded = function (data) {
        var sessionInfo = function (trackId, timeSlotId) {
            var result = ko.utils.arrayFirst(data.Sessions, function (session) {
                return session.TrackId == trackId && session.TimeSlotId == timeSlotId;
            });

            return result || { Title: "", Speaker: "" };
        }

        var viewModel = {};
        viewModel.Tracks = data.Tracks;
        viewModel.TimeSlots = data.TimeSlots;
        viewModel.sessionInfo = sessionInfo;
        viewModel.prettifyTime = prettifyTime;
        viewModel.isSession = isSession;
        viewModel.click = function (session, e) {
            window.interactions.openPropertySheet("sessiondetail", session.Title).done(function () {
                ko.applyBindings(session, $("main > aside.propertySheet > div")[0]);
            });

            e.stopPropagation();
            e.preventDefault();
        };

        ko.applyBindings(viewModel, $("article")[0]);
        interactions.slideToTab('1');
    }

    var prettifyTime = function (datetimeString) {
        return datetimeString.replace("/", " - ")
    }

    var isSession = function (timeSlot, session)
    {
        if (!session.Title || (timeSlot.Info && timeSlot.Info != "Keynote"))
        {
            return '';
        }

        return 'session';
    }

    function pad(pad, str, padLeft) {
        if (str == undefined) return pad;
        if (padLeft) {
            return (pad + str).slice(-pad.length);
        } else {
            return (str + pad).substring(0, pad.length);
        }
    }

    $(function () {
        $.get("content/agenda-friday.json").done(agendaLoaded);
    });

</script>